{
	"info": {
		"_postman_id": "ishikawa-diagram-collection",
		"name": "Ishikawa Diagram Management",
		"description": "Complete API collection for Ishikawa (Fishbone) Diagram management in CAPA workspace. Includes creation, retrieval, and deletion of Ishikawa diagrams with proper authentication and validation.",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "qms-system"
	},
	"item": [
		{
			"name": "Create Ishikawa Diagram",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 201\", function () {",
							"    pm.response.to.have.status(201);",
							"});",
							"",
							"pm.test(\"Response has required fields\", function () {",
							"    var jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('_id');",
							"    pm.expect(jsonData).to.have.property('library');",
							"    pm.expect(jsonData).to.have.property('problems');",
							"});",
							"",
							"// Save the created Ishikawa ID for other requests",
							"if (pm.response.code === 201) {",
							"    var responseJson = pm.response.json();",
							"    pm.environment.set(\"ishikawa_id\", responseJson._id);",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"value": "Bearer {{access_token}}",
						"description": "JWT access token for authentication"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"library\": \"{{library_id}}\",\n  \"createdBy\": \"{{user_id}}\",\n  \"problems\": [\n    {\n      \"problem\": \"Product quality issues\",\n      \"category\": [\n        {\n          \"name\": \"People\",\n          \"cause\": [\n            \"Insufficient training\",\n            \"Lack of experience\",\n            \"Communication breakdown\"\n          ]\n        },\n        {\n          \"name\": \"Process\",\n          \"cause\": [\n            \"Inadequate quality control\",\n            \"Missing standard procedures\",\n            \"Poor workflow design\"\n          ]\n        },\n        {\n          \"name\": \"Materials\",\n          \"cause\": [\n            \"Substandard raw materials\",\n            \"Supplier quality issues\",\n            \"Storage problems\"\n          ]\n        },\n        {\n          \"name\": \"Equipment\",\n          \"cause\": [\n            \"Machine malfunction\",\n            \"Lack of maintenance\",\n            \"Outdated technology\"\n          ]\n        },\n        {\n          \"name\": \"Environment\",\n          \"cause\": [\n            \"Temperature fluctuations\",\n            \"Humidity issues\",\n            \"Workspace conditions\"\n          ]\n        },\n        {\n          \"name\": \"Methods\",\n          \"cause\": [\n            \"Incorrect procedures\",\n            \"Lack of documentation\",\n            \"Inconsistent methodology\"\n          ]\n        }\n      ]\n    }\n  ]\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{base_url}}/v1/ishikawa",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"v1",
						"ishikawa"
					]
				},
				"description": "Creates a new Ishikawa (Fishbone) diagram for root cause analysis. Requires authentication and valid library/user IDs. The diagram follows the 6M methodology: People, Process, Materials, Equipment, Environment, and Methods."
			},
			"response": [
				{
					"name": "Success - Ishikawa Created",
					"originalRequest": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"library\": \"674a2b5c8f123456789abcde\",\n  \"createdBy\": \"674a2b5c8f123456789abcdf\",\n  \"problems\": [\n    {\n      \"problem\": \"Product quality issues\",\n      \"category\": [\n        {\n          \"name\": \"People\",\n          \"cause\": [\"Insufficient training\", \"Lack of experience\"]\n        }\n      ]\n    }\n  ]\n}"
						},
						"url": {
							"raw": "{{base_url}}/v1/ishikawa",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"v1",
								"ishikawa"
							]
						}
					},
					"status": "Created",
					"code": 201,
					"_postman_previewlanguage": "json",
					"header": [
						{
							"key": "Content-Type",
							"value": "application/json"
						}
					],
					"cookie": [],
					"body": "{\n  \"_id\": \"674a2b5c8f123456789abce0\",\n  \"library\": \"674a2b5c8f123456789abcde\",\n  \"createdBy\": \"674a2b5c8f123456789abcdf\",\n  \"problems\": [\n    {\n      \"problem\": \"Product quality issues\",\n      \"category\": [\n        {\n          \"name\": \"People\",\n          \"cause\": [\"Insufficient training\", \"Lack of experience\"]\n        }\n      ]\n    }\n  ],\n  \"createdAt\": \"2024-11-30T10:15:30.123Z\",\n  \"updatedAt\": \"2024-11-30T10:15:30.123Z\"\n}"
				}
			]
		},
		{
			"name": "Get Ishikawa by ID",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Response contains Ishikawa data\", function () {",
							"    var jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('_id');",
							"    pm.expect(jsonData).to.have.property('library');",
							"    pm.expect(jsonData).to.have.property('problems');",
							"    pm.expect(jsonData.problems).to.be.an('array');",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{access_token}}",
						"description": "JWT access token for authentication"
					}
				],
				"url": {
					"raw": "{{base_url}}/v1/ishikawa/libraries/{{library_id}}/ishikawa/{{ishikawa_id}}",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"v1",
						"ishikawa",
						"libraries",
						"{{library_id}}",
						"ishikawa",
						"{{ishikawa_id}}"
					]
				},
				"description": "Retrieves a specific Ishikawa diagram by its ID within a library. Requires authentication and valid library/ishikawa IDs."
			},
			"response": [
				{
					"name": "Success - Ishikawa Retrieved",
					"originalRequest": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/v1/ishikawa/libraries/674a2b5c8f123456789abcde/ishikawa/674a2b5c8f123456789abce0",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"v1",
								"ishikawa",
								"libraries",
								"674a2b5c8f123456789abcde",
								"ishikawa",
								"674a2b5c8f123456789abce0"
							]
						}
					},
					"status": "OK",
					"code": 200,
					"_postman_previewlanguage": "json",
					"header": [
						{
							"key": "Content-Type",
							"value": "application/json"
						}
					],
					"cookie": [],
					"body": "{\n  \"_id\": \"674a2b5c8f123456789abce0\",\n  \"library\": {\n    \"_id\": \"674a2b5c8f123456789abcde\",\n    \"name\": \"Quality Management Library\"\n  },\n  \"createdBy\": {\n    \"_id\": \"674a2b5c8f123456789abcdf\",\n    \"firstName\": \"John\",\n    \"lastName\": \"Doe\"\n  },\n  \"problems\": [\n    {\n      \"problem\": \"Product quality issues\",\n      \"category\": [\n        {\n          \"name\": \"People\",\n          \"cause\": [\"Insufficient training\", \"Lack of experience\"]\n        }\n      ]\n    }\n  ],\n  \"createdAt\": \"2024-11-30T10:15:30.123Z\",\n  \"updatedAt\": \"2024-11-30T10:15:30.123Z\"\n}"
				}
			]
		},
		{
			"name": "Get Ishikawa by Library ID",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Response contains results array\", function () {",
							"    var jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('results');",
							"    pm.expect(jsonData.results).to.be.an('array');",
							"});",
							"",
							"pm.test(\"Response contains pagination info\", function () {",
							"    var jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('page');",
							"    pm.expect(jsonData).to.have.property('limit');",
							"    pm.expect(jsonData).to.have.property('totalPages');",
							"    pm.expect(jsonData).to.have.property('totalResults');",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{access_token}}",
						"description": "JWT access token for authentication"
					}
				],
				"url": {
					"raw": "{{base_url}}/v1/ishikawa/libraries/{{library_id}}/ishikawa?page=1&limit=10&search=quality",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"v1",
						"ishikawa",
						"libraries",
						"{{library_id}}",
						"ishikawa"
					],
					"query": [
						{
							"key": "page",
							"value": "1",
							"description": "Page number for pagination (default: 1)"
						},
						{
							"key": "limit",
							"value": "10",
							"description": "Number of items per page (default: 10)"
						},
						{
							"key": "search",
							"value": "quality",
							"description": "Search term to filter Ishikawa diagrams"
						}
					]
				},
				"description": "Retrieves all Ishikawa diagrams within a specific library with pagination and search capabilities. Supports filtering by search terms."
			},
			"response": [
				{
					"name": "Success - Ishikawa List Retrieved",
					"originalRequest": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/v1/ishikawa/libraries/674a2b5c8f123456789abcde/ishikawa?page=1&limit=10",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"v1",
								"ishikawa",
								"libraries",
								"674a2b5c8f123456789abcde",
								"ishikawa"
							],
							"query": [
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "limit",
									"value": "10"
								}
							]
						}
					},
					"status": "OK",
					"code": 200,
					"_postman_previewlanguage": "json",
					"header": [
						{
							"key": "Content-Type",
							"value": "application/json"
						}
					],
					"cookie": [],
					"body": "{\n  \"results\": [\n    {\n      \"_id\": \"674a2b5c8f123456789abce0\",\n      \"library\": \"674a2b5c8f123456789abcde\",\n      \"createdBy\": {\n        \"_id\": \"674a2b5c8f123456789abcdf\",\n        \"firstName\": \"John\",\n        \"lastName\": \"Doe\"\n      },\n      \"problems\": [\n        {\n          \"problem\": \"Product quality issues\",\n          \"category\": [\n            {\n              \"name\": \"People\",\n              \"cause\": [\"Insufficient training\"]\n            }\n          ]\n        }\n      ],\n      \"createdAt\": \"2024-11-30T10:15:30.123Z\"\n    }\n  ],\n  \"page\": 1,\n  \"limit\": 10,\n  \"totalPages\": 1,\n  \"totalResults\": 1\n}"
				}
			]
		},
		{
			"name": "Delete Ishikawa Diagram",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 204\", function () {",
							"    pm.response.to.have.status(204);",
							"});",
							"",
							"pm.test(\"Response message confirms deletion\", function () {",
							"    if (pm.response.text()) {",
							"        var jsonData = pm.response.json();",
							"        pm.expect(jsonData).to.have.property('message');",
							"        pm.expect(jsonData.message).to.include('delete');",
							"    }",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "DELETE",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{access_token}}",
						"description": "JWT access token for authentication"
					}
				],
				"url": {
					"raw": "{{base_url}}/v1/ishikawa/libraries/{{library_id}}/ishikawa/{{ishikawa_id}}",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"v1",
						"ishikawa",
						"libraries",
						"{{library_id}}",
						"ishikawa",
						"{{ishikawa_id}}"
					]
				},
				"description": "Permanently deletes a specific Ishikawa diagram. Requires authentication and appropriate permissions. This action cannot be undone."
			},
			"response": [
				{
					"name": "Success - Ishikawa Deleted",
					"originalRequest": {
						"method": "DELETE",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/v1/ishikawa/libraries/674a2b5c8f123456789abcde/ishikawa/674a2b5c8f123456789abce0",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"v1",
								"ishikawa",
								"libraries",
								"674a2b5c8f123456789abcde",
								"ishikawa",
								"674a2b5c8f123456789abce0"
							]
						}
					},
					"status": "No Content",
					"code": 204,
					"_postman_previewlanguage": "json",
					"header": [
						{
							"key": "Content-Type",
							"value": "application/json"
						}
					],
					"cookie": [],
					"body": "{\n  \"message\": \"delete Ishikawa successfully\"\n}"
				}
			]
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Set default environment variables if not already set",
					"if (!pm.environment.get('base_url')) {",
					"    pm.environment.set('base_url', 'http://localhost:3000');",
					"}",
					"",
					"// Check if access token exists",
					"if (!pm.environment.get('access_token')) {",
					"    console.log('Warning: access_token not set. Please authenticate first.');",
					"}",
					"",
					"// Set default IDs if not already set (for testing)",
					"if (!pm.environment.get('library_id')) {",
					"    pm.environment.set('library_id', '674a2b5c8f123456789abcde');",
					"}",
					"",
					"if (!pm.environment.get('user_id')) {",
					"    pm.environment.set('user_id', '674a2b5c8f123456789abcdf');",
					"}"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Global test to check response time",
					"pm.test('Response time is less than 5000ms', function () {",
					"    pm.expect(pm.response.responseTime).to.be.below(5000);",
					"});",
					"",
					"// Global test to check for common error responses",
					"if (pm.response.code >= 400) {",
					"    pm.test('Error response has message', function () {",
					"        var jsonData = pm.response.json();",
					"        pm.expect(jsonData).to.have.property('message');",
					"    });",
					"}"
				]
			}
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:3000",
			"description": "Base URL for the QMS API"
		},
		{
			"key": "library_id",
			"value": "",
			"description": "CAPA Library ID for Ishikawa diagrams"
		},
		{
			"key": "user_id",
			"value": "",
			"description": "User ID for creating Ishikawa diagrams"
		},
		{
			"key": "ishikawa_id",
			"value": "",
			"description": "Ishikawa diagram ID (auto-set after creation)"
		},
		{
			"key": "access_token",
			"value": "",
			"description": "JWT access token for authentication"
		}
	]
}
